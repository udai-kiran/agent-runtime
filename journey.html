<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Runtime · Developer Journey</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,500;0,600;0,700;0,800;1,500;1,600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:       #f0f4fa;
      --surface:  #ffffff;
      --surface2: #eaeef6;
      --surface3: #dde4f0;
      --border:   #ccd5e8;
      --border2:  #b4c2d8;
      --text:     #354858;
      --text-hi:  #0e1c2c;
      --text-lo:  #7890a4;

      /* stage accent colors */
      --c-plan:    #5520e8;
      --c-explore: #0088bb;
      --c-design:  #c07800;
      --c-build:   #00945a;
      --c-review:  #d41845;
      --c-test:    #7828d8;
      --c-ship:    #0078a8;

      /* domain colors */
      --d-general:  #5848d0;
      --d-featdev:  #b06800;
      --d-python:   #1068cc;
      --d-react:    #0080a8;
      --d-go:       #007088;
      --d-c:        #5870a0;
      --d-sql:      #b85000;
      --d-infra:    #00804a;
      --d-quality:  #c01438;
      --d-testing:  #0a8040;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'JetBrains Mono', 'Cascadia Code', 'Fira Code', 'Menlo', monospace;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* ─── dot grid atmosphere ─── */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: radial-gradient(circle, #b8c8dc 1px, transparent 1px);
      background-size: 28px 28px;
      opacity: 0.35;
      pointer-events: none;
      z-index: 0;
    }

    /* ─── vignette ─── */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at center, transparent 50%, rgba(210, 220, 235, 0.55) 100%);
      pointer-events: none;
      z-index: 0;
    }

    #header, #stage-nav, #board, #focus-nav, #tooltip { position: relative; z-index: 1; }

    /* ═══════════════════════════════════════════
       HEADER
    ═══════════════════════════════════════════ */
    #header {
      height: 46px;
      padding: 0 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      background: rgba(240, 244, 250, 0.92);
      backdrop-filter: blur(12px);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 24px;
      height: 24px;
      border: 1.5px solid var(--c-build);
      border-radius: 5px;
      display: grid;
      place-items: center;
      font-size: 12px;
      color: var(--c-build);
      font-weight: 700;
      box-shadow: 0 0 10px rgba(0, 148, 90, 0.2), inset 0 0 8px rgba(0, 148, 90, 0.04);
      animation: logo-pulse 3s ease-in-out infinite;
    }

    @keyframes logo-pulse {
      0%, 100% { box-shadow: 0 0 10px rgba(0, 148, 90, 0.2),  inset 0 0 8px rgba(0, 148, 90, 0.04); }
      50%       { box-shadow: 0 0 18px rgba(0, 148, 90, 0.35), inset 0 0 12px rgba(0, 148, 90, 0.08); }
    }

    .logo-text {
      font-size: 12.5px;
      font-weight: 600;
      letter-spacing: 0.04em;
      color: var(--text);
      line-height: 1;
    }

    .logo-text strong {
      color: var(--text-hi);
      font-weight: 700;
    }

    .logo-text .sep { color: var(--text-lo); margin: 0 5px; }

    .logo-text .sub { color: var(--text); font-weight: 500; }

    #legend {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-lo);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legend-skill {
      width: 28px;
      height: 10px;
      border-radius: 2px;
      border: 1px solid var(--border2);
      border-left: 3px solid var(--text-lo);
      background: var(--surface3);
      position: relative;
      overflow: hidden;
    }

    .legend-skill::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(0,0,0,0.06), transparent);
      animation: rail-flow 2.5s ease-in-out infinite;
    }

    .legend-agent {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid var(--border2);
      border-left: 3px solid var(--text-lo);
      background: var(--surface2);
    }

    .legend-card-skill {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid var(--border2);
      border-left: 3px dashed var(--text-lo);
      background: var(--surface2);
    }

    .legend-sep {
      width: 1px;
      height: 16px;
      background: var(--border);
    }

    #hints {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 10px;
      color: var(--text);
      letter-spacing: 0.06em;
    }

    .hint { display: flex; align-items: center; gap: 4px; }

    kbd {
      background: var(--surface3);
      border: 1px solid var(--border2);
      border-radius: 3px;
      padding: 1px 5px;
      font-size: 9.5px;
      font-family: inherit;
      color: var(--text-hi);
      font-weight: 600;
    }

    /* ═══════════════════════════════════════════
       STAGE NAV
    ═══════════════════════════════════════════ */
    #stage-nav {
      display: flex;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      background: rgba(240, 244, 250, 0.88);
    }

    .snav {
      flex: 1;
      padding: 7px 4px 6px;
      text-align: center;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: border-color 0.2s, background 0.2s;
      position: relative;
      overflow: hidden;
      user-select: none;
    }

    .snav::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--sc, #fff);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .snav:hover::after  { opacity: 0.04; }
    .snav.active::after { opacity: 0.07; }
    .snav.active { border-bottom-color: var(--sc); }

    .snav-num {
      display: block;
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 0.14em;
      color: var(--text-lo);
      margin-bottom: 2px;
      transition: color 0.2s;
    }

    .snav-icon {
      display: block;
      font-size: 13px;
      line-height: 1;
      margin-bottom: 2px;
      transition: transform 0.2s;
    }

    .snav:hover .snav-icon, .snav.active .snav-icon { transform: scale(1.15); }

    .snav-label {
      display: block;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text);
      transition: color 0.2s;
    }

    .snav.active .snav-num,
    .snav.active .snav-label,
    .snav:hover  .snav-num,
    .snav:hover  .snav-label { color: var(--sc); }

    /* ═══════════════════════════════════════════
       BOARD
    ═══════════════════════════════════════════ */
    #board {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px 10px 6px;
      gap: 5px;
      overflow: hidden;
      min-height: 0;
    }

    /* ═══════════════════════════════════════════
       SKILL RAILS
    ═══════════════════════════════════════════ */
    #rails {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .rail-row {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .rail {
      height: 20px;
      border-radius: 3px;
      border: 1px solid rgba(var(--rr), var(--rg), var(--rb), 0.3);
      border-left: 2px solid rgba(var(--rr), var(--rg), var(--rb), 0.85);
      background: linear-gradient(
        90deg,
        rgba(var(--rr), var(--rg), var(--rb), 0.10) 0%,
        rgba(var(--rr), var(--rg), var(--rb), 0.04) 50%,
        rgba(var(--rr), var(--rg), var(--rb), 0.10) 100%
      );
      display: flex;
      align-items: center;
      padding: 0 8px;
      gap: 6px;
      font-size: 9.5px;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: rgba(var(--rr), var(--rg), var(--rb), 1);
      overflow: hidden;
      white-space: nowrap;
      position: relative;
    }

    /* animated shimmer — current flowing through the trace */
    .rail::after {
      content: '';
      position: absolute;
      top: 0; left: -70%; width: 50%; height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(var(--rr), var(--rg), var(--rb), 0.18),
        transparent
      );
      animation: rail-flow var(--rail-speed, 2.8s) ease-in-out infinite;
    }

    @keyframes rail-flow {
      0%   { left: -60%; }
      100% { left: 110%; }
    }

    .rail-type {
      font-size: 7px;
      font-weight: 800;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      opacity: 0.55;
      background: rgba(var(--rr), var(--rg), var(--rb), 0.12);
      border: 1px solid rgba(var(--rr), var(--rg), var(--rb), 0.25);
      border-radius: 2px;
      padding: 0 4px;
      line-height: 14px;
      flex-shrink: 0;
    }

    .rail-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      background: rgba(var(--rr), var(--rg), var(--rb), 1);
      flex-shrink: 0;
      animation: dot-blink var(--rail-speed, 2.8s) ease-in-out infinite;
    }

    @keyframes dot-blink {
      0%, 90%, 100% { opacity: 1; }
      45%           { opacity: 0.15; }
    }

    /* ═══════════════════════════════════════════
       COLUMNS
    ═══════════════════════════════════════════ */
    #columns {
      flex: 1;
      display: flex;
      gap: 6px;
      overflow: hidden;
      min-height: 0;
    }

    .col {
      flex: 1 1 0;
      min-width: 0;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 7px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      cursor: pointer;
      transition:
        flex           0.42s cubic-bezier(0.4, 0, 0.2, 1),
        border-color   0.22s ease,
        box-shadow     0.22s ease,
        opacity        0.3s ease;
      position: relative;
    }

    /* top accent stripe */
    .col-stripe {
      height: 2px;
      background: var(--cc);
      opacity: 0;
      transition: opacity 0.22s;
      flex-shrink: 0;
    }

    .col:hover .col-stripe  { opacity: 0.5; }
    .col.focused .col-stripe { opacity: 1; box-shadow: 0 0 8px var(--cc); }

    .col:hover:not(.focused) {
      border-color: color-mix(in srgb, var(--cc) 30%, var(--border));
    }

    .col.focused {
      flex: 5 1 0;
      border-color: color-mix(in srgb, var(--cc) 55%, var(--border));
      box-shadow:
        0 0 28px color-mix(in srgb, var(--cc) 10%, transparent),
        inset 0 0 50px color-mix(in srgb, var(--cc) 2%, transparent);
      cursor: default;
    }

    .col.dim {
      flex: 0.45 1 0;
      opacity: 0.25;
      pointer-events: none;
      border-color: var(--border);
    }

    .col.dim .col-stripe { opacity: 0; }

    /* ─── column header ─── */
    .col-head {
      padding: 9px 10px 7px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .col-top {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 3px;
    }

    .col-num {
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 0.12em;
      color: var(--cc);
      opacity: 0.7;
    }

    .col-icon {
      font-size: 13px;
      line-height: 1;
    }

    .col-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--cc);
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .col-badge {
      font-size: 9.5px;
      font-weight: 700;
      color: var(--text);
      background: var(--surface3);
      border-radius: 8px;
      padding: 1px 6px;
      flex-shrink: 0;
    }

    .col-desc {
      font-size: 9.5px;
      color: var(--text);
      line-height: 1.5;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      transition: color 0.2s;
    }

    .col:hover .col-desc,
    .col.focused .col-desc { color: var(--text); }

    /* ─── column body ─── */
    .col-body {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-height: 0;
      scrollbar-width: thin;
      scrollbar-color: var(--border2) transparent;
    }

    .col-body::-webkit-scrollbar { width: 3px; }
    .col-body::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    /* ─── domain group label ─── */
    .dg {
      font-size: 8.5px;
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text);
      padding: 6px 3px 2px;
      margin-top: 1px;
      opacity: 0;
      transition: opacity 0.25s;
    }

    .dg:first-child { padding-top: 3px; }
    .col.focused .dg { opacity: 1; }

    /* ─── agent card ─── */
    .card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-left: 2px solid var(--dc);
      border-radius: 4px;
      padding: 5px 7px;
      position: relative;
      overflow: hidden;
      transition: background 0.15s, border-color 0.15s, transform 0.12s;
    }

    .card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        120deg,
        rgba(var(--dr), var(--dg), var(--db), 0.07) 0%,
        transparent 55%
      );
      opacity: 0;
      transition: opacity 0.18s;
    }

    .col.focused .card { cursor: pointer; }

    .col.focused .card:hover {
      background: var(--bg);
      border-color: color-mix(in srgb, var(--dc) 55%, var(--border));
      transform: translateX(3px);
    }

    .col.focused .card:hover::before { opacity: 1; }

    .card-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-hi);
      display: flex;
      align-items: flex-start;
      gap: 5px;
      line-height: 1.3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* In focus mode: let names and tags render in full */
    .col.focused .card-name {
      white-space: normal;
      overflow: visible;
      align-items: center;
    }

    .col.focused .card-tag {
      white-space: normal;
      overflow: visible;
    }


    .card-name::before {
      content: '▸';
      font-size: 7px;
      color: var(--dc);
      flex-shrink: 0;
      opacity: 0.75;
    }

    .card-type {
      margin-left: auto;
      font-size: 7px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-lo);
      background: var(--surface3);
      border: 1px solid var(--border);
      border-radius: 2px;
      padding: 0 4px;
      line-height: 14px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .col.focused .card-type { opacity: 1; }

    /* Skill cards — dashed left border + tinted badge */
    .card--skill {
      border-left-style: dashed;
    }

    .card--skill .card-type {
      color: var(--dc);
      background: color-mix(in srgb, var(--dc) 10%, transparent);
      border-color: color-mix(in srgb, var(--dc) 35%, transparent);
    }

    .card-tag {
      font-size: 9px;
      font-weight: 600;
      color: var(--dc);
      margin-top: 2px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.85;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* description — only rendered in focus mode */
    .card-body {
      display: none;
      font-size: 10px;
      font-weight: 500;
      font-style: italic;
      color: var(--text);
      line-height: 1.65;
      margin-top: 5px;
      padding-top: 5px;
      border-top: 1px solid var(--border2);
    }

    .col.focused .card-body { display: block; }

    /* ═══════════════════════════════════════════
       FOCUS NAV
    ═══════════════════════════════════════════ */
    #focus-nav {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      align-items: center;
      gap: 5px;
      background: rgba(245, 248, 254, 0.96);
      backdrop-filter: blur(16px);
      border: 1px solid var(--border2);
      border-radius: 9px;
      padding: 5px 8px;
      z-index: 100;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
    }

    body.in-focus #focus-nav { display: flex; }

    .nav-btn {
      background: var(--surface3);
      border: 1px solid var(--border2);
      color: var(--text-hi);
      padding: 4px 12px;
      border-radius: 5px;
      font-size: 11px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 3px;
      letter-spacing: 0.04em;
    }

    .nav-btn:hover:not(:disabled) {
      background: var(--border2);
      color: var(--text-hi);
    }

    .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }

    #focus-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--focus-c, var(--text));
      min-width: 68px;
      text-align: center;
    }

    .nav-divider {
      width: 1px;
      height: 16px;
      background: var(--border2);
      margin: 0 3px;
    }

    .nav-esc {
      font-size: 9.5px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 3px;
    }

    /* ═══════════════════════════════════════════
       TOOLTIP (overview mode)
    ═══════════════════════════════════════════ */
    #tooltip {
      position: fixed;
      display: none;
      background: #ffffff;
      border: 1px solid var(--border2);
      border-radius: 6px;
      padding: 8px 11px;
      font-size: 10.5px;
      max-width: 230px;
      line-height: 1.65;
      color: var(--text-hi);
      pointer-events: none;
      z-index: 200;
      box-shadow: 0 10px 32px rgba(0, 0, 0, 0.12);
    }

    .tip-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
      padding-bottom: 4px;
      border-bottom: 1px solid var(--border2);
    }

    .tip-name {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--tip-c, var(--text));
    }

    .tip-type {
      font-size: 7.5px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      padding: 1px 5px;
      border-radius: 3px;
      border: 1px solid var(--tip-c, var(--border2));
      color: var(--tip-c, var(--text));
      background: color-mix(in srgb, var(--tip-c, transparent) 8%, transparent);
      flex-shrink: 0;
    }

    /* ═══════════════════════════════════════════
       PRESENTATION MODE
    ═══════════════════════════════════════════ */
    body.presentation #hints   { opacity: 0; pointer-events: none; }
    body.presentation #stage-nav { display: none; }

    /* ═══════════════════════════════════════════
       ENTRY ANIMATION
    ═══════════════════════════════════════════ */
    .col {
      animation: col-enter 0.5s ease both;
    }

    .col:nth-child(1) { animation-delay: 0.04s; }
    .col:nth-child(2) { animation-delay: 0.10s; }
    .col:nth-child(3) { animation-delay: 0.16s; }
    .col:nth-child(4) { animation-delay: 0.22s; }
    .col:nth-child(5) { animation-delay: 0.28s; }
    .col:nth-child(6) { animation-delay: 0.34s; }
    .col:nth-child(7) { animation-delay: 0.40s; }

    @keyframes col-enter {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0);    }
    }

    .rail {
      animation: rail-enter 0.4s ease both;
    }

    .rail-row:nth-child(1) .rail { animation-delay: 0.5s; }
    .rail-row:nth-child(2) .rail { animation-delay: 0.6s; }

    @keyframes rail-enter {
      from { opacity: 0; transform: scaleX(0.7); transform-origin: left; }
      to   { opacity: 1; transform: scaleX(1); }
    }
  </style>
</head>
<body>

<!-- ══════════════ HEADER ══════════════ -->
<div id="header">
  <div class="logo">
    <div class="logo-mark">◈</div>
    <div class="logo-text">
      <strong>agent</strong>runtime
      <span class="sep">·</span>
      <span class="sub">developer journey</span>
    </div>
  </div>
  <div id="legend">
    <div class="legend-item"><div class="legend-skill"></div>skill</div>
    <div class="legend-item"><div class="legend-agent"></div>agent</div>
  </div>
  <div class="legend-sep"></div>
  <div id="hints">
    <div class="hint"><kbd>click</kbd> focus</div>
    <div class="hint"><kbd>←</kbd><kbd>→</kbd> navigate</div>
    <div class="hint"><kbd>esc</kbd> overview</div>
    <div class="hint"><kbd>p</kbd> presentation</div>
  </div>
</div>

<!-- ══════════════ STAGE NAV ══════════════ -->
<div id="stage-nav"></div>

<!-- ══════════════ BOARD ══════════════ -->
<div id="board">
  <div id="rails"></div>
  <div id="columns"></div>
</div>

<!-- ══════════════ FOCUS NAV ══════════════ -->
<div id="focus-nav">
  <button class="nav-btn" id="btn-prev">← prev</button>
  <span id="focus-label"></span>
  <button class="nav-btn" id="btn-next">next →</button>
  <div class="nav-divider"></div>
  <span class="nav-esc"><kbd>esc</kbd> back</span>
</div>

<!-- ══════════════ TOOLTIP ══════════════ -->
<div id="tooltip">
  <div class="tip-header">
    <div class="tip-name" id="tip-name"></div>
    <span class="tip-type" id="tip-type"></span>
  </div>
  <div id="tip-body"></div>
</div>

<script>
// ================================================================
// DATA
// ================================================================

const STAGES = [
  { id: 'plan',    n: '01', label: 'Plan',    icon: '⬡', color: '#5520e8', desc: 'Understand the ticket · decompose work' },
  { id: 'explore', n: '02', label: 'Explore', icon: '⊕', color: '#0088bb', desc: 'Navigate codebase · trace execution paths' },
  { id: 'design',  n: '03', label: 'Design',  icon: '◈', color: '#c07800', desc: 'Architecture · schemas · API contracts' },
  { id: 'build',   n: '04', label: 'Build',   icon: '▶', color: '#00945a', desc: 'Implementation · debugging · features' },
  { id: 'review',  n: '05', label: 'Review',  icon: '⬕', color: '#d41845', desc: 'Code quality · type safety · patterns' },
  { id: 'test',    n: '06', label: 'Test',    icon: '◎', color: '#7828d8', desc: 'Coverage · E2E testing · security scans' },
  { id: 'ship',    n: '07', label: 'Ship',    icon: '↑', color: '#0078a8', desc: 'PR review · documentation · deployment' },
];

// from/to: 0-indexed column positions (inclusive)
// Rows are packed to avoid overlap: check grid-column = from+1 / to+2
const RAILS = [
  // row 0 — wide banner
  { label: 'feature-dev — guided 7-phase workflow',    rgb: [160, 100,  0],  from: 0, to: 5, row: 0, speed: '3.2s' },
  // row 1 — docs · ralph · review-pr (non-overlapping: cols 2-3, 4-5, 6-7)
  { label: 'docs — fetch live package docs',           rgb: [ 40, 140,  60], from: 1, to: 2, row: 1, speed: '2.8s' },
  { label: 'ralph-wiggum — iterative refinement loop', rgb: [180,  20, 120], from: 3, to: 4, row: 1, speed: '1.9s' },
  { label: 'review-pr — orchestrated PR review',       rgb: [  0, 120, 168], from: 5, to: 6, row: 1, speed: '2.5s' },
  // row 2 — frontend-design · code-review (non-overlapping: cols 3-4, 5)
  { label: 'frontend-design — production UI workflow', rgb: [160,  40, 200], from: 2, to: 3, row: 2, speed: '3.0s' },
  { label: 'code-review — focused code review',        rgb: [160,  70,  10], from: 4, to: 4, row: 2, speed: '2.2s' },
];

// domain → { hex, rgb }
const DC = {
  general:  { hex: '#5848d0', rgb: [ 88,  72, 208] },
  'feat-dev': { hex: '#b06800', rgb: [176, 104,   0] },
  python:   { hex: '#1068cc', rgb: [ 16, 104, 204] },
  react:    { hex: '#0080a8', rgb: [  0, 128, 168] },
  go:       { hex: '#007088', rgb: [  0, 112, 136] },
  c:        { hex: '#5870a0', rgb: [ 88, 112, 160] },
  sql:      { hex: '#b85000', rgb: [184,  80,   0] },
  infra:    { hex: '#00804a', rgb: [  0, 128,  74] },
  quality:  { hex: '#c01438', rgb: [192,  20,  56] },
  testing:  { hex: '#0a8040', rgb: [ 10, 128,  64] },
};

const AGENTS = {
  plan: [
    { name: 'planner',          domain: 'general', desc: 'Feature planning, task decomposition, sequencing, and risk assessment across multiple languages and components.' },
    { name: 'system-architect', domain: 'general', desc: 'System-wide architecture, API contracts, service boundaries, data flow, and technology selection.' },
    { name: 'api-designer',     domain: 'general', desc: 'REST, GraphQL, gRPC API design; versioning strategies, authentication, and rate limiting patterns.' },
  ],
  explore: [
    { name: 'code-explorer',  domain: 'feat-dev', desc: 'Traces execution paths, maps architecture layers, understands patterns, and documents dependencies to inform new development.' },
    { name: 'code-architect', domain: 'feat-dev', desc: 'Analyzes codebase patterns and provides comprehensive implementation blueprints with specific files to create or modify.' },
  ],
  design: [
    { name: 'architect', domain: 'python', desc: 'Python module structure, SOLID principles, design patterns, and refactoring strategy.' },
    { name: 'architect', domain: 'react',  desc: 'Component hierarchies, state management, performance patterns, and TypeScript architecture.' },
    { name: 'architect', domain: 'go',     desc: 'Package design, dependency direction, interface design, and concurrency architecture.' },
    { name: 'architect', domain: 'c',      desc: 'C systems structure, module API design, memory management strategy, and concurrency approach.' },
    { name: 'schema-designer',  domain: 'sql', desc: 'Database schema design, normalization, migration planning, and referential integrity.' },
    { name: 'query-optimizer',  domain: 'sql', desc: 'Query performance analysis, execution plans, and index design.' },
  ],
  build: [
    { name: 'fastapi',              domain: 'python', desc: 'FastAPI routers, dependency injection, Pydantic models, lifespan, middleware, and async patterns.' },
    { name: 'django',               domain: 'python', desc: 'Models, views, DRF serializers, ORM queries, migrations, settings, and async support.' },
    { name: 'debugger',             domain: 'python', desc: 'Root cause analysis and minimal targeted fixes for Python errors, exceptions, and test failures.' },
    { name: 'refactor',             domain: 'python', desc: 'Executes targeted, safe Python refactors guided by architect recommendations. Reads, rewrites, verifies.' },
    { name: 'hooks-specialist',     domain: 'react',  desc: 'Custom hooks, hook patterns, dependency optimization, and complex state and side-effect management.' },
    { name: 'usability-specialist', domain: 'react',  desc: 'UX, accessibility, semantic HTML, keyboard navigation, and responsive design.' },
    { name: 'cli-builder',          domain: 'go',     desc: 'Go CLI tools with Cobra/flag, UX patterns, configuration handling, and output formatting.' },
    { name: 'network-specialist',   domain: 'c',      desc: 'Network servers/clients, protocol implementation, sockets, and event-driven I/O.' },
    { name: 'docker',               domain: 'infra',  desc: 'Dockerfiles, multi-stage builds, docker-compose configurations, and image optimization.' },
    { name: 'kubernetes',           domain: 'infra',  desc: 'Manifests, Helm charts, deployments, RBAC configuration, and networking.' },
    { name: 'terraform',            domain: 'infra',  desc: 'IaC modules, state management, multi-environment deployments, and Terraform best practices.' },
    { name: 'devops-specialist',    domain: 'infra',  desc: 'CI/CD pipelines, containerization, orchestration, infrastructure as code, and monitoring.' },
  ],
  review: [
    { name: 'code-reviewer',         domain: 'quality', desc: 'Project guidelines, style guides, and best practices. Use proactively after writing code, before PRs.' },
    { name: 'type-design-analyzer',  domain: 'quality', desc: 'Type encapsulation, invariant expression, usefulness, and enforcement ratings.' },
    { name: 'comment-analyzer',      domain: 'quality', desc: 'Comment accuracy, completeness, and long-term maintainability (comment rot detection).' },
    { name: 'code-simplifier',       domain: 'quality', desc: 'Simplifies code for clarity, consistency, and maintainability while preserving functionality.' },
    { name: 'silent-failure-hunter', domain: 'quality', desc: 'Silent failures, inadequate error handling, and inappropriate fallback behavior.' },
    { name: 'reviewer', domain: 'python', desc: 'SOLID principles, type hints, docstrings, error handling, and PEP 8.' },
    { name: 'reviewer', domain: 'react',  desc: 'Hooks, component design, performance, accessibility, and type safety.' },
    { name: 'reviewer', domain: 'go',     desc: 'Idiomatic patterns, error handling, concurrency safety, and standard library usage.' },
    { name: 'reviewer', domain: 'c',      desc: 'Memory safety, error handling, portability, and modern C best practices.' },
    { name: 'reviewer', domain: 'sql',    desc: 'Security, performance, correctness, and migration safety.' },
  ],
  test: [
    { name: 'test-writer',      domain: 'python',  desc: 'Focused, fast pytest unit and integration tests with proper fixtures and coverage.' },
    { name: 'security',         domain: 'python',  desc: 'bandit, pip-audit, OWASP top 10, hardcoded secrets detection, and insecure defaults.' },
    { name: 'playwright',       domain: 'testing', desc: 'E2E tests, browser automation, visual regression testing, and Playwright best practices.' },
    { name: 'pr-test-analyzer', domain: 'quality', desc: 'Test coverage completeness and quality review for PRs — identifies critical gaps and edge cases.' },
  ],
  ship: [
    { name: 'documentation-writer', domain: 'general', desc: 'README, API docs, architecture guides, ADRs, runbooks, and onboarding documentation.' },
    { name: 'devops-specialist',    domain: 'infra',   desc: 'Deployment strategy, monitoring setup, alerting, and infrastructure provisioning.' },
  ],
};

// ================================================================
// RENDER — Stage Nav
// ================================================================

const navEl = document.getElementById('stage-nav');
STAGES.forEach((s, i) => {
  const el = document.createElement('div');
  el.className = 'snav';
  el.style.setProperty('--sc', s.color);
  el.innerHTML = `
    <span class="snav-num">${s.n}</span>
    <span class="snav-icon">${s.icon}</span>
    <span class="snav-label">${s.label}</span>
  `;
  el.addEventListener('click', () => setFocus(focusedIdx === i ? -1 : i));
  navEl.appendChild(el);
});

// ================================================================
// RENDER — Rails
// ================================================================

const railsEl = document.getElementById('rails');
const rows = {};
RAILS.forEach(r => { (rows[r.row] = rows[r.row] || []).push(r); });

Object.keys(rows).sort((a, b) => a - b).forEach(rowKey => {
  const rowEl = document.createElement('div');
  rowEl.className = 'rail-row';
  rows[rowKey].forEach(r => {
    const [rr, rg, rb] = r.rgb;
    const el = document.createElement('div');
    el.className = 'rail';
    el.style.cssText = `
      --rr: ${rr}; --rg: ${rg}; --rb: ${rb};
      --rail-speed: ${r.speed};
      grid-column: ${r.from + 1} / ${r.to + 2};
    `;
    el.innerHTML = `<div class="rail-dot"></div><span class="rail-type">skill</span>${r.label}`;
    rowEl.appendChild(el);
  });
  railsEl.appendChild(rowEl);
});

// ================================================================
// RENDER — Columns
// ================================================================

const colsEl = document.getElementById('columns');

STAGES.forEach((stage, i) => {
  const agents = AGENTS[stage.id] || [];

  // group by domain, preserving insertion order
  const groups = new Map();
  agents.forEach(a => {
    if (!groups.has(a.domain)) groups.set(a.domain, []);
    groups.get(a.domain).push(a);
  });

  let cardsHTML = '';
  groups.forEach((list, domain) => {
    const d = DC[domain] || { hex: '#546880', rgb: [ 84, 104, 128] };
    const [dr, dg, db] = d.rgb;
    cardsHTML += `<div class="dg">${domain}</div>`;
    list.forEach(a => {
      cardsHTML += `
        <div class="card"
             style="--dc:${d.hex}; --dr:${dr}; --dg:${dg}; --db:${db}"
             data-name="${a.name}"
             data-domain="${domain}"
             data-color="${d.hex}"
             data-type="agent"
             data-desc="${a.desc.replace(/"/g, '&quot;')}">
          <div class="card-name">${a.name}<span class="card-type">agent</span></div>
          <div class="card-tag">${domain}</div>
          <div class="card-body">${a.desc}</div>
        </div>`;
    });
  });

  const col = document.createElement('div');
  col.className = 'col';
  col.id = `col${i}`;
  col.style.setProperty('--cc', stage.color);
  col.innerHTML = `
    <div class="col-stripe"></div>
    <div class="col-head">
      <div class="col-top">
        <span class="col-num">${stage.n}</span>
        <span class="col-icon">${stage.icon}</span>
        <span class="col-label">${stage.label}</span>
        <span class="col-badge">${agents.length}</span>
      </div>
      <div class="col-desc">${stage.desc}</div>
    </div>
    <div class="col-body">${cardsHTML}</div>
  `;

  col.addEventListener('click', () => { if (focusedIdx !== i) setFocus(i); });
  colsEl.appendChild(col);
});

// ================================================================
// FOCUS
// ================================================================

let focusedIdx = -1;
let presentationMode = false;

function setFocus(idx) {
  focusedIdx = idx;

  const cols    = document.querySelectorAll('.col');
  const navBtns = document.querySelectorAll('.snav');
  const label   = document.getElementById('focus-label');
  const prevBtn = document.getElementById('btn-prev');
  const nextBtn = document.getElementById('btn-next');

  if (idx === -1) {
    document.body.classList.remove('in-focus');
    cols.forEach(c => c.classList.remove('focused', 'dim'));
    navBtns.forEach(n => n.classList.remove('active'));
  } else {
    document.body.classList.add('in-focus');
    cols.forEach((c, i) => {
      c.classList.remove('focused', 'dim');
      if (i === idx) { c.classList.add('focused'); }
      else           { c.classList.add('dim');     }
    });
    navBtns.forEach((n, i) => n.classList.toggle('active', i === idx));

    const s = STAGES[idx];
    label.textContent = s.label;
    label.style.setProperty('--focus-c', s.color);
    prevBtn.disabled = idx === 0;
    nextBtn.disabled = idx === STAGES.length - 1;
  }
}

document.getElementById('btn-prev').addEventListener('click', () => {
  if (focusedIdx > 0) setFocus(focusedIdx - 1);
});
document.getElementById('btn-next').addEventListener('click', () => {
  if (focusedIdx < STAGES.length - 1) setFocus(focusedIdx + 1);
});

// ================================================================
// KEYBOARD
// ================================================================

document.addEventListener('keydown', e => {
  if (e.target.tagName === 'INPUT') return;
  switch (e.key) {
    case 'Escape':
      setFocus(-1);
      break;
    case 'ArrowRight':
      if (focusedIdx === -1) setFocus(0);
      else if (focusedIdx < STAGES.length - 1) setFocus(focusedIdx + 1);
      break;
    case 'ArrowLeft':
      if (focusedIdx > 0)    setFocus(focusedIdx - 1);
      else if (focusedIdx === 0) setFocus(-1);
      break;
    case 'p': case 'P':
      presentationMode = !presentationMode;
      document.body.classList.toggle('presentation', presentationMode);
      break;
  }
});

// ================================================================
// TOOLTIP (overview mode only)
// ================================================================

const tip     = document.getElementById('tooltip');
const tipName = document.getElementById('tip-name');
const tipType = document.getElementById('tip-type');
const tipBody = document.getElementById('tip-body');

document.addEventListener('mouseover', e => {
  if (focusedIdx !== -1) { tip.style.display = 'none'; return; }
  const card = e.target.closest('.card');
  if (!card) { tip.style.display = 'none'; return; }
  tipName.textContent = `${card.dataset.name} · ${card.dataset.domain}`;
  tipName.style.setProperty('--tip-c', card.dataset.color);
  tipType.textContent = card.dataset.type || 'agent';
  tipType.style.setProperty('--tip-c', card.dataset.color);
  tipBody.textContent = card.dataset.desc;
  tip.style.display = 'block';
});

document.addEventListener('mousemove', e => {
  if (tip.style.display === 'none') return;
  tip.style.left = Math.min(e.clientX + 14, window.innerWidth  - 248) + 'px';
  tip.style.top  = Math.max(e.clientY -  6, 8)                        + 'px';
});

document.addEventListener('mouseout', e => {
  if (!e.relatedTarget?.closest?.('.card')) tip.style.display = 'none';
});
</script>
</body>
</html>
